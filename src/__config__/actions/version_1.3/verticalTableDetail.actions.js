import { isArray } from 'util';
import network, {
  urlSearchParams
} from '../../../__utils__/network';
import getComponentName from '../../../__utils__/getModuleName';

export default {
  getObjectForMainTableForm({
    dispatch,
    commit
  }, {
    table,
    objid
  }) { // Ëé∑Âèñ‰∏ªË°®Èù¢ÊùøÊï∞ÊçÆ
    const id = objid === 'New' ? '-1' : objid;
    network.post('/p/cs/getObject', urlSearchParams({
      table,
      objid: id,
    })).then((res) => {
      const resData = res.data.data;
      commit('updateCopyDataForRealdOnly', resData); // Â§çÂà∂ÊåâÈíÆÊìç‰Ωú‰øùÂ≠òÈªòËÆ§Êï∞ÊçÆ
      dispatch('updateObjectForMainTableForm').then(() => {
        commit('updateObjectForMainTableForm', resData);
      });
    });
  },
  updateObjectForMainTableForm({
    commit
  }) {
    commit('updateFormDataForRefshow');
  },
  getObjectTabForMainTable({
    commit,
    state
  }, { // Ëé∑Âèñ‰∏ªË°®ÊåâÈíÆÂíåÂ≠êË°®‰ø°ÊÅØ
    table,
    objid,
    type,
    tabIndex,
    itemTabelPageInfo
  }) {
    const id = objid === 'New' ? '-1' : objid;
    network.post('/p/cs/objectTab', urlSearchParams({
      table,
      objid: id,
      ismaintable: 'y'
    })).then((res) => {
      if (res.data.code === 0) {
        const resData = res.data.data;
        if (type === 'copy') {
          resData.type = 'copy';
          commit('updateMainButtonsData', resData);
          commit('updateMainTabPanelsData', resData, itemTabelPageInfo);
        } else {
          commit('updateMainButtonsData', resData);
          commit('updateMainTabPanelsData', resData, itemTabelPageInfo);
        }

        if (resData.reftabs && resData.reftabs.length > 0) {
          const firstReftab = resData.reftabs[state.tabCurrentIndex];
          // Ëé∑ÂèñÂ≠êË°®ÊåâÈíÆ
          if (type !== 'copy') { // ÊåâÈíÆÊâßË°åÂ§çÂà∂ÊñπÊ≥ïÊó∂Ôºå‰∏çË∞ÉÁî®Â≠êË°®Áõ∏ÂÖ≥Êé•Âè£
            let webactType = '';
            if (resData.reftabs[0].webact) { // Ëá™ÂÆö‰πâtabÂÖ®ÂÆöÂà∂ÔºåtabÂàáÊç¢Êó∂‰∏çÈúÄË¶ÅËØ∑Ê±Ç
              webactType = resData.reftabs[0].webact.substring(0, resData.reftabs[0].webact.lastIndexOf('/')).toUpperCase();
            }
            if (webactType !== 'ALL') {
              const getObjectTabPromise = new Promise((rec, rej) => {
                if (this._actions[`${getComponentName()}/getObjectTabForRefTable`] && this._actions[`${getComponentName()}/getObjectTabForRefTable`].length > 0 && typeof this._actions[`${getComponentName()}/getObjectTabForRefTable`][0] === 'function') {
                  const param = {
                    table: firstReftab.tablename,
                    objid,
                    tabIndex,
                    rec,
                    rej
                  };
                  this._actions[`${getComponentName()}/getObjectTabForRefTable`][0](param);
                }
              });
              if (resData.reftabs[0].refcolid !== -1) {
                // commit('updateActiveRefFormInfo', resData.reftabs[0]);
                // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™tabÁöÑÂ≠êË°®Ë°®Âçï
                if (this._actions[`${getComponentName()}/getFormDataForRefTable`] && this._actions[`${getComponentName()}/getFormDataForRefTable`].length > 0 && typeof this._actions[`${getComponentName()}/getFormDataForRefTable`][0] === 'function') {
                  const formParam = {
                    table: firstReftab.tablename,
                    inlinemode: firstReftab.tabinlinemode,
                    tabIndex
                  };
                  this._actions[`${getComponentName()}/getFormDataForRefTable`][0](formParam);
                }
                // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™tabÁöÑÂ≠êË°®ÂàóË°®Êï∞ÊçÆ
                if (resData.reftabs[0].tabrelation === '1:m') {
                  getObjectTabPromise.then(() => {
                    if (this._actions[`${getComponentName()}/getObjectTableItemForTableData`] && this._actions[`${getComponentName()}/getObjectTableItemForTableData`].length > 0 && typeof this._actions[`${getComponentName()}/getObjectTableItemForTableData`][0] === 'function') {
                      const tableParam = {
                        table: firstReftab.tablename,
                        objid,
                        refcolid: firstReftab.refcolid,
                        searchdata: {
                          startindex: itemTabelPageInfo ? (Number(itemTabelPageInfo.currentPageIndex) - 1) * Number(itemTabelPageInfo.pageSize) : 0,
                          range: itemTabelPageInfo ? itemTabelPageInfo.pageSize : 10,
                          column_include_uicontroller: true
                        },
                        tabIndex
                      };
                      this._actions[`${getComponentName()}/getObjectTableItemForTableData`][0](tableParam);
                    }
                  });
                } else if (resData.reftabs[0].tabrelation === '1:1') {
                  // Ëé∑ÂèñÂ≠êË°®Èù¢ÊùøÊï∞ÊçÆ
                  if (this._actions[`${getComponentName()}/getItemObjForChildTableForm`] && this._actions[`${getComponentName()}/getItemObjForChildTableForm`].length > 0 && typeof this._actions[`${getComponentName()}/getItemObjForChildTableForm`][0] === 'function') {
                    const tableParam = {
                      table: firstReftab.tablename,
                      objid,
                      refcolid: firstReftab.refcolid,
                      tabIndex
                    };
                    this._actions[`${getComponentName()}/getItemObjForChildTableForm`][0](tableParam);
                  }
                }
              }
            }
          }
        }
      }
    });
  },
  getObjectTabForRefTable({
    commit
  }, { // Ëé∑ÂèñÂ≠êË°®ÊåâÈíÆ
    table,
    objid,
    tabIndex,
    rec,
    rej
  }) {
    const id = objid === 'New' ? '-1' : objid;
    network.post('/p/cs/objectTab', urlSearchParams({
      table,
      objid: id,
      ismaintable: 'n'
    })).then((res) => {
      if (res.data.code === 0) {
        rec();
        const resData = res.data.data;
        resData.tabIndex = tabIndex;
        commit('updateRefButtonsData', resData);
      } else {
        rej();
      }
    });
  },
  getFormDataForRefTable({
    commit
  }, { // Ëé∑ÂèñÂ≠êË°®Ë°®ÂçïÊï∞ÊçÆ
    table,
    inlinemode,
    tabIndex
  }) {
    network.post('/p/cs/inputForitem', urlSearchParams({
      table,
      inlinemode
    })).then((res) => {
      if (res.data.code === 0) {
        const resData = res.data.data;
        resData.tabIndex = tabIndex;
        commit('updateFormDataForRefTable', resData);
      }
    });
  },
  getObjectTableItemForTableData({
    commit
  }, { // Ëé∑ÂèñÂ≠êË°®ÂàóË°®Êï∞ÊçÆ
    table,
    objid,
    refcolid,
    searchdata,
    tabIndex // fixedcolumns - objectIds
  }) {
    const id = objid === 'New' ? '-1' : objid;
    network.post('/p/cs/objectTableItem', urlSearchParams({
      table,
      objid: id, // -1 ‰ª£Ë°®Êñ∞Â¢û
      refcolid,
      searchdata
    })).then((res) => {
      if (res.data.code === 0) {
        const resData = res.data.datas;
        resData.tabIndex = tabIndex;
        commit('updateTableListForRefTable', resData);
      }
    });
  },

  // ÊåâÈíÆ
  getItemObjForChildTableForm({
    commit
  }, {
    table,
    objid,
    refcolid,
    tabIndex
  }) { // Ëé∑ÂèñÂ≠êË°®Èù¢Êùø‰ø°ÊÅØ
    // ÂèÇÊï∞ËØ¥Êòé  table Â≠êË°®Ë°®ÂêçÔºåobjidÂàóË°®ÁïåÈù¢ËØ•Ë°åÊï∞ÊçÆÁöÑid‰πüÂ∞±ÊòØrowidÔºårefcolidÂ≠êË°®id
    const id = objid === 'New' ? '-1' : objid;
    network.post('/p/cs/itemObj', urlSearchParams({
      table,
      objid: id,
      refcolid
    })).then((res) => {
      if (res.data.code === 0) {
        const formData = res.data.data;
        formData.tabIndex = tabIndex;
        commit('updatePanelData', formData);
      }
    });
  },
  // performMainTableSaveAction({
  //   commit
  // }, {
  //   parame,
  //   resolve,
  //   reject
  // }) { // ‰∏ªË°®‰øùÂ≠ò
  //   const {
  //     tableName
  //   } = parame;
  //   const {
  //     add
  //   } = parame;
  //   const {
  //     objId
  //   } = parame;
  //   const {
  //     type
  //   } = parame;
  //   const {
  //     itemName
  //   } = parame;
  //   const {
  //     itemCurrentParameter
  //   } = parame;
  //   const {
  //     isreftabs
  //   } = parame;
  //   const {
  //     itemNameGroup
  //   } = parame;
  //   const { sataType } = parame;
  //   const { modify } = parame;
  //   let parames = {};
  //   let labelName = {};
  //   let fkId = {};
  //   let labelData = {};
  //   let fkIdData = {};
  //   const modifyDataForSaveAfter = {};
  //   debugger;
  //   const modifyDataForSave = {};


  //   if (type === 'add') {
  //     if (Object.keys(add).length > 0) {
  //       labelData = Object.assign({}, Object.keys(add).reduce((obj, value) => add[value], {}));
  //       fkIdData = Object.assign({}, Object.keys(add).reduce((obj, value) => add[value], {}));
  //     }
  //   } else if (type === 'modify') {
  //     if (Object.keys(modify).length > 0) {
  //       labelData = Object.assign({}, Object.keys(modify).reduce((obj, value) => modify[value], {}));
  //       fkIdData = Object.assign({}, Object.keys(modify).reduce((obj, value) => modify[value], {}));
  //     }
  //   }
  //   if (type === 'modify') {
  //     labelName = Object.keys(labelData).reduce((obj, value) => {
  //       if (labelData[value] && Array.isArray(labelData[value]) && labelData[value].length === 1) { // ÊòØÂ§ñÈîÆÁ±ªÂûã(Â§ñÈîÆÂçïÈÄâ)
  //         const label = labelData[value].map(item => item.Label);
  //         if (label[0] !== '') {
  //           labelData[value] = label[0];
  //         }
  //       }
  //       if (labelData[value] && Array.isArray(labelData[value]) && labelData[value].length > 1) { // Â§ñÈîÆÂ§öÈÄâ
  //         const label = labelData[value].map(item => item.Label).join(',');
  //         labelData[value] = label[0];
  //       }
  //       obj[value] = labelData[value];
  //       return obj;
  //     }, {});
  //     console.log('üçì', labelName);
  //     const modifyChangeDataAfter = Object.assign({}, labelData, labelName);

  //     modifyDataForSaveAfter[tableName] = modifyChangeDataAfter;
  //   }

  //   if (Object.keys(fkIdData).length > 0) {
  //     fkId = Object.keys(fkIdData).reduce((obj, value) => {
  //       if (fkIdData[value] && Array.isArray(fkIdData[value]) && fkIdData[value].length === 1) { // ÊòØÂ§ñÈîÆÁ±ªÂûã(Â§ñÈîÆÂçïÈÄâ)
  //         const ID = fkIdData[value].map(item => item.ID);
  //         if (ID[0] !== '' && ID[0] !== 'undefined') {
  //           fkIdData[value] = Number(ID[0]);
  //         }
  //       }
  
  //       if (fkIdData[value] && Array.isArray(fkIdData[value]) && fkIdData[value].length > 1) { // Â§ñÈîÆÂ§öÈÄâ
  //         const ID = fkIdData[value].map(item => item.ID).join(',');
  //         fkIdData[value] = ID[0];
  //       }

  //       obj[value] = fkIdData[value];
  //       return obj;
  //     }, {});

  //     const modifyChangeData = Object.assign({}, fkIdData, fkId);
  //     modifyDataForSave[tableName] = modifyChangeData;
  //   }

  
  //   console.log('modifyDataForSave', modifyDataForSave);
  //   console.log('modifyDataForSaveAfter', modifyDataForSaveAfter);
  //   if (type === 'add') { // Êñ∞Â¢û‰øùÂ≠òÂèÇÊï∞
  //     if (isreftabs) { // Â≠òÂú®Â≠êË°®
  //       if (itemNameGroup.length > 0) {
  //         const itemAdd = itemCurrentParameter.add;
  //         const {
  //           addDefault
  //         } = itemCurrentParameter;

  //         if (Object.values(itemAdd[itemName]).length > 0) {
  //           const itemTableAdd = Object.assign({}, itemAdd);
  //           itemTableAdd[itemName].ID = objId;
  //           itemTableAdd[itemName] = [
  //             itemTableAdd[itemName]
  //           ];
  //           parames = {
  //             table: tableName, // ‰∏ªË°®Ë°®Âêç
  //             objid: objId, // Âõ∫ÂÆö‰º†ÂÄº-1 Ë°®Á§∫Êñ∞Â¢û
  //             data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
  //               ...add,
  //               ...itemTableAdd,
  //             }
  //           };
  //         } else if (Object.values(addDefault[itemName]).length > 0) { // Â¶ÇÊûúÂ≠êË°®ÊúâÈªòËÆ§ÂÄº
  //           const itemTableAdd = Object.assign({}, addDefault);
  //           itemTableAdd[itemName].ID = objId;
  //           itemTableAdd[itemName] = [
  //             itemTableAdd[itemName]
  //           ];
  //           parames = {
  //             table: tableName, // ‰∏ªË°®Ë°®Âêç
  //             objid: objId, // Âõ∫ÂÆö‰º†ÂÄº-1 Ë°®Á§∫Êñ∞Â¢û
  //             data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
  //               ...add,
  //               ...itemTableAdd,
  //             }
  //           };
  //         } else {
  //           parames = {
  //             table: tableName, // ‰∏ªË°®Ë°®Âêç
  //             objid: objId, // Âõ∫ÂÆö‰º†ÂÄº-1 Ë°®Á§∫Êñ∞Â¢û
  //             data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
  //               ...modifyDataForSave,
  //             }
  //           };
  //         }
  //       } else {
  //         parames = {
  //           table: tableName, // ‰∏ªË°®Ë°®Âêç
  //           objid: objId,
  //           data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
  //             ...modifyDataForSave,
  //           }
  //         };
  //       }
  //     } else {
  //       parames = {
  //         table: tableName, // ‰∏ªË°®Ë°®Âêç
  //         objid: objId, // Âõ∫ÂÆö‰º†ÂÄº-1 Ë°®Á§∫Êñ∞Â¢û
  //         data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
  //           ...modifyDataForSave
  //         }
  //       };
  //     }
  //     network.post('/p/cs/objectAdd', urlSearchParams(parames)).then((res) => {
  //       if (res.data.code === 0) {
  //         const data = res.data;
  //         resolve();
  //         commit('updateNewMainTableAddSaveData', {
  //           data,
  //           itemName
  //         });
  //       } else {
  //         reject();
  //       }
  //     });
  //   } else if (type === 'modify') { // ÁºñËæë‰øùÂ≠òÂèÇÊï∞
  //     const itemModify = itemCurrentParameter ? itemCurrentParameter.modify : {};// Â≠êË°®‰øÆÊîπ

  //     const itemDefault = itemCurrentParameter ? itemCurrentParameter.default : {};
  //     const itemAdd = itemCurrentParameter ? itemCurrentParameter.add : {};// Â≠êË°®Êñ∞Â¢û
  //     // const itemDefault = itemCurrentParameter.addDefault;// Â≠êË°®Êñ∞Â¢û
  //     const sataTypeName = sataType ? sataType.sataType : '';
  //     const dufault = parame.default;
  //     if (sataTypeName === 'add') { // Â≠êË°®Êñ∞Â¢û
  //       const addDefault = itemCurrentParameter ? itemCurrentParameter.addDefault : {};
  //       const add = Object.assign({}, addDefault[itemName], itemAdd[itemName]);// Êï¥ÂêàÂ≠êË°®Êñ∞Â¢ûÂíåÈªòËÆ§ÂÄºÊï∞ÊçÆ
  //       Object.assign(itemAdd[itemName], add);
  //       const itemTableAdd = Object.assign({}, itemAdd);
  //       itemTableAdd[itemName].ID = -1;
  //       itemTableAdd[itemName] = [
  //         itemTableAdd[itemName]
  //       ];
  //       parames = {
  //         table: tableName, // ‰∏ªË°®Ë°®Âêç
  //         objid: objId, // ÊòéÁªÜid
  //         data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
  //           ...itemTableAdd
  //         }
  //       };
  //       network.post('/p/cs/objectSave', urlSearchParams(parames)).then((res) => {
  //         if (res.data.code === 0) {
  //           const data = res.data;
  //           resolve();
  //           commit('updateNewMainTableAddSaveData', { data, itemName });
  //         } else {
  //           reject();
  //         }
  //       });
  //     } else if (sataTypeName === 'modify') {
  //       const defaultData = [];
  //       const defaultForSaveArray = [];
  //       const defaultForSave = {};
  //       const dufaultDataForSave = {};
  //       itemModify[itemName].forEach((modifyItem) => {
  //         itemDefault[itemName].forEach((defaultItem) => {
  //           if (modifyItem.ID === defaultItem.EXCEPT_COLUMN_NAME) {
  //             Object.keys(defaultItem).reduce((obj, item) => {
  //               Object.keys(modifyItem).reduce((modifyDataObj, modifyDataItem) => {
  //                 if (item === modifyDataItem) {
  //                   let itemDefault = {};
  //                   defaultForSave[modifyDataItem] = defaultItem[item];
  //                   itemDefault = Object.assign({}, modifyItem, defaultForSave);
  //                   defaultForSaveArray.push(itemDefault);
  //                 }
  //                 return modifyDataObj;
  //               }, {});
  //               return obj;
  //             }, {});
  //             defaultData.push(defaultItem);
  //           }
  //         });
  //       });
  //       dufaultDataForSave[tableName] = defaultForSave;
  //       parames = {
  //         table: tableName,
  //         objid: objId,
  //         data: { ...itemModify },
  //         after: { ...itemModify },
  //         before: { defaultForSaveArray }
  //       };
  //       network.post('/p/cs/objectSave', urlSearchParams(parames)).then((res) => {
  //         if (res.data.code === 0) {
  //           const data = res.data;
  //           resolve();
  //           commit('updateNewMainTableAddSaveData', { data, itemName });
  //         } else {
  //           reject();
  //         }
  //       });
  //     } else if (sataTypeName === 'addAndModify') {
  //       if (Object.values(itemAdd[itemName]).length > 0) {
  //         const addDefault = itemCurrentParameter ? itemCurrentParameter.addDefault : {};
  //         const add = Object.assign({}, addDefault[itemName], itemAdd[itemName]);// Êï¥ÂêàÂ≠êË°®Êñ∞Â¢ûÂíåÈªòËÆ§ÂÄºÊï∞ÊçÆ
  //         Object.assign(itemAdd[itemName], add);
  //         const itemTableAdd = Object.assign({}, itemAdd);
  //         itemTableAdd[itemName].ID = -1;
  //         itemTableAdd[itemName] = [
  //           itemTableAdd[itemName]
  //         ];
  //         parames = {
  //           table: tableName, // ‰∏ªË°®Ë°®Âêç
  //           objid: objId, // ÊòéÁªÜid
  //           data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
  //             ...itemTableAdd
  //           }
  //         };
  //         network.post('/p/cs/objectSave', urlSearchParams(parames)).then((res) => {
  //           if (res.data.code === 0) {
  //             const data = res.data;
  //             resolve();
  //             commit('updateNewMainTableAddSaveData', { data, itemName });
  //           } else {
  //             reject();
  //           }
  //         });
  //       }
  //       if (Object.values(itemModify[itemName]).length > 0) {
  //         const defaultData = [];
  //         const defaultForSaveArray = [];
  //         const defaultForSave = {};
  //         const dufaultDataForSave = {};
  //         itemModify[itemName].forEach((modifyItem) => {
  //           itemDefault[itemName].forEach((defaultItem) => {
  //             if (modifyItem.ID === defaultItem.EXCEPT_COLUMN_NAME) {
  //               Object.keys(defaultItem).reduce((obj, item) => {
  //                 Object.keys(modifyItem).reduce((modifyDataObj, modifyDataItem) => {
  //                   if (item === modifyDataItem) {
  //                     let itemDefault = {};
  //                     defaultForSave[modifyDataItem] = defaultItem[item];
  //                     itemDefault = Object.assign({}, modifyItem, defaultForSave);
  //                     defaultForSaveArray.push(itemDefault);
  //                   }
  //                   return modifyDataObj;
  //                 }, {});
  //                 return obj;
  //               }, {});
  //               defaultData.push(defaultItem);
  //             }
  //           });
  //         });
  //         dufaultDataForSave[tableName] = defaultForSave;
  //         parames = {
  //           table: tableName,
  //           objid: objId,
  //           data: { ...itemModify },
  //           after: { ...itemModify },
  //           before: { defaultForSaveArray }
  //         };
  //         network.post('/p/cs/objectSave', urlSearchParams(parames)).then((res) => {
  //           if (res.data.code === 0) {
  //             const data = res.data;
  //             resolve();
  //             commit('updateNewMainTableAddSaveData', { data, itemName });
  //           } else {
  //             reject();
  //           }
  //         });
  //       }
  //     } else {
  //       const dufaultData = dufault[tableName];
  //       const defaultForSave = {};
  //       const dufaultDataForSave = {};
  //       Object.keys(dufaultData).reduce((obj, item) => {
  //         const modifyData = modify[tableName];
  //         Object.keys(modifyData).reduce((modifyDataObj, modifyDataItem) => {
  //           if (item === modifyDataItem) {
  //             defaultForSave[modifyDataItem] = dufaultData[item];
  //           }
  //           return modifyDataObj;
  //         }, {});
  //         return obj;
  //       }, {});
  //       const defaultChangeDataAfterlabelName = Object.keys(defaultForSave).reduce((obj, value) => {
  //         if (defaultForSave[value] && Array.isArray(defaultForSave[value]) && defaultForSave[value].length === 1) { // ÊòØÂ§ñÈîÆÁ±ªÂûã(Â§ñÈîÆÂçïÈÄâ)
  //           const label = defaultForSave[value].map(item => item.Label);
  //           if (label[0] !== '') {
  //             defaultForSave[value] = label[0];
  //           }
  //         }
  //         if (defaultForSave[value] && Array.isArray(defaultForSave[value]) && defaultForSave[value].length > 1) { // Â§ñÈîÆÂ§öÈÄâ
  //           const label = defaultForSave[value].map(item => item.Label).join(',');
  //           defaultForSave[value] = label[0];
  //         }
  //         obj[value] = defaultForSave[value];
  //         return obj;
  //       }, {});
  //       dufaultDataForSave[tableName] = defaultChangeDataAfterlabelName;
  //       parames = {
  //         table: tableName,
  //         objid: objId,
  //         data: modifyDataForSave,
  //         after: modifyDataForSaveAfter,
  //         before: dufaultDataForSave
  //       };
  //       network.post('/p/cs/objectSave', urlSearchParams(parames)).then((res) => {
  //         if (res.data.code === 0) {
  //           const data = res.data;
  //           resolve();
  //           commit('updateNewMainTableAddSaveData', { data, itemName });
  //         } else {
  //           reject();
  //         }
  //       });
  //     }
  //   }
  // },
  
 
  performMainTableDeleteAction({
    commit
  }, {
    path,
    table,
    objId,
    currentParameter,
    itemName,
    isreftabs,
    resolve, reject
  }) { // ‰∏ªË°®Âà†Èô§
    let parames = {};
    if (isreftabs) {
      parames = {
        table, // ‰∏ªË°®Ë°®Âêç
        objid: objId,
        delMTable: true
      };
    } else {
      parames = {
        table, // ‰∏ªË°®Ë°®Âêç
        objid: objId,
        delMTable: true
      };
    }
    network.post(path || '/p/cs/objectDelete', urlSearchParams(parames)).then((res) => {
      if (res.data.code === 0) {
        resolve();
        const data = res.data;
        commit('updateNewMainTableDeleteData', data);
      } else {
        reject();
      }
    });
  },

  performMainTableSaveAction({
    commit
  }, {
    parame,
    resolve,
    reject
  }) { // ‰∏ªË°®‰øùÂ≠ò
    const {
      tableName
    } = parame;
    const {
      add
    } = parame;
    const {
      objId
    } = parame;
    const {
      type
    } = parame;
    const {
      itemName
    } = parame;
    const {
      itemCurrentParameter
    } = parame;
    const {
      isreftabs
    } = parame;
    const {
      itemNameGroup
    } = parame;
    const { sataType } = parame;
    let parames = {};
    if (type === 'add') { // Êñ∞Â¢û‰øùÂ≠òÂèÇÊï∞
      if (isreftabs) { // Â≠òÂú®Â≠êË°®
        if (itemNameGroup.length > 0) {
          const itemAdd = itemCurrentParameter.add;
          const {
            addDefault
          } = itemCurrentParameter;

          if (Object.values(itemAdd[itemName]).length > 0) {
            const itemTableAdd = Object.assign({}, itemAdd);
            itemTableAdd[itemName].ID = objId;
            itemTableAdd[itemName] = [
              itemTableAdd[itemName]
            ];
            parames = {
              table: tableName, // ‰∏ªË°®Ë°®Âêç
              objid: objId, // Âõ∫ÂÆö‰º†ÂÄº-1 Ë°®Á§∫Êñ∞Â¢û
              data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
                ...add,
                ...itemTableAdd,
              }
            };
          } else if (Object.values(addDefault[itemName]).length > 0) { // Â¶ÇÊûúÂ≠êË°®ÊúâÈªòËÆ§ÂÄº
            const itemTableAdd = Object.assign({}, addDefault);
            itemTableAdd[itemName].ID = objId;
            itemTableAdd[itemName] = [
              itemTableAdd[itemName]
            ];
            parames = {
              table: tableName, // ‰∏ªË°®Ë°®Âêç
              objid: objId, // Âõ∫ÂÆö‰º†ÂÄº-1 Ë°®Á§∫Êñ∞Â¢û
              data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
                ...add,
                ...itemTableAdd,
              }
            };
          } else {
            parames = {
              table: tableName, // ‰∏ªË°®Ë°®Âêç
              objid: objId, // Âõ∫ÂÆö‰º†ÂÄº-1 Ë°®Á§∫Êñ∞Â¢û
              data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
                ...add,
              }
            };
          }
        } else {
          parames = {
            table: tableName, // ‰∏ªË°®Ë°®Âêç
            objid: objId,
            data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
              ...add,
            }
          };
        }
      } else {
        parames = {
          table: tableName, // ‰∏ªË°®Ë°®Âêç
          objid: objId, // Âõ∫ÂÆö‰º†ÂÄº-1 Ë°®Á§∫Êñ∞Â¢û
          data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
            ...add
          }
        };
      }
      network.post('/p/cs/objectAdd', urlSearchParams(parames)).then((res) => {
        if (res.data.code === 0) {
          const data = res.data;
          resolve();
          commit('updateNewMainTableAddSaveData', {
            data,
            itemName
          });
        } else {
          reject();
        }
      });
    } else if (type === 'modify') { // ÁºñËæë‰øùÂ≠òÂèÇÊï∞
      const { modify } = parame;
      const { modifyLabel } = parame;// ‰∏ªË°®‰øÆÊîπÁöÑlabel
      let itemModifyLabel = {};// Â≠êË°®‰øÆÊîπÁöÑlabel
      let itemBeforeLabel = {};
      if (parame.itemCurrentParameter) { // Â≠êË°®ÂèñÂÄº
        itemModifyLabel = parame.itemCurrentParameter.modifyLabel;// Â≠êË°®‰øÆÊîπÁöÑlabel
        itemBeforeLabel = parame.itemCurrentParameter.itemBeforeLabel;// beforeÂÄº
      }
      const modifyLabelregroup = parame.modifyLabel[tableName];// Áî®‰∫ébegore afterÂ≠óÊÆµÁøªËØë‰øÆÊîπËøáÂêéÁöÑ‰∏≠Êñálabel
      const defaultLabelregroup = parame.defaultLabel[tableName];// Áî®‰∫ébegore afterÂ≠óÊÆµÁøªËØë‰øÆÊîπËøáÂêéÁöÑ‰∏≠ÊñáÈªòËÆ§label(ÂåÖÂê´ÊâÄÊúâÊé•Âè£ËøîÂõûÂÄº)
      const labelregroup = {};// Áî®‰∫ébegore afterÂ≠óÊÆµÁøªËØë‰øÆÊîπËøáÂêéÁöÑ‰∏≠ÊñáÈªòËÆ§labelÔºà‰øÆÊîπËøáÂêéÁöÑËøîÂõûÂÄºÔºâ
      Object.keys(defaultLabelregroup).reduce((obj, item) => {
        Object.keys(modifyLabelregroup).forEach((modifyDataItem) => {
          if (item === modifyDataItem) {
            labelregroup[item] = defaultLabelregroup[modifyDataItem];
            return false;
          }
          return true;
        });

        return {};
      }, {});
      const labelregroupTableName = {// label‰øÆÊîπËøáÂêéÁöÑÂÄº
        [tableName]: labelregroup
      };
      const itemModify = itemCurrentParameter ? itemCurrentParameter.modify : {};// Â≠êË°®‰øÆÊîπ
      const itemAdd = itemCurrentParameter ? itemCurrentParameter.add : {};// Â≠êË°®Êñ∞Â¢û
      const sataTypeName = sataType ? sataType.sataType : '';
      if (sataTypeName === 'add') { // Â≠êË°®Êñ∞Â¢û
        const addDefault = itemCurrentParameter ? itemCurrentParameter.addDefault : {};
        const add = Object.assign({}, addDefault[itemName], itemAdd[itemName]);// Êï¥ÂêàÂ≠êË°®Êñ∞Â¢ûÂíåÈªòËÆ§ÂÄºÊï∞ÊçÆ
        Object.assign(itemAdd[itemName], add);
        const itemTableAdd = Object.assign({}, itemAdd);
        itemTableAdd[itemName].ID = -1;
        itemTableAdd[itemName] = [
          itemTableAdd[itemName]
        ];
        parames = {
          table: tableName, // ‰∏ªË°®Ë°®Âêç
          objid: objId, // ÊòéÁªÜid
          data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
            ...itemTableAdd
          }
        };
      } else if (sataTypeName === 'modify') {
        parames = {
          table: tableName,
          objid: objId,
          data: { ...itemModify },
          after: itemModifyLabel,
          before: itemBeforeLabel,
        };
      } else if (sataTypeName === 'addAndModify') {
        const addDefault = itemCurrentParameter ? itemCurrentParameter.addDefault : {};
        const add = Object.assign({}, addDefault[itemName], itemAdd[itemName]);// Êï¥ÂêàÂ≠êË°®Êñ∞Â¢ûÂíåÈªòËÆ§ÂÄºÊï∞ÊçÆ
        Object.assign(itemAdd[itemName], add);
        const itemTableAdd = Object.assign({}, itemAdd);
        itemTableAdd[itemName].ID = -1;
        itemTableAdd[itemName] = [
          itemTableAdd[itemName]
        ];
        if (Object.values(itemAdd[itemName]).length > 0) {
          parames = {
            table: tableName, // ‰∏ªË°®Ë°®Âêç
            objid: objId, // ÊòéÁªÜid
            data: { // Âõ∫ÂÆöÁªìÊûÑÔºö fixedData:{ '‰∏ªË°®Ë°®Âêç': { '‰∏ªË°®Â≠óÊÆµ1'Ôºö 'Â≠óÊÆµ1ÁöÑÂÄº', .... } }
              ...itemTableAdd
            }
          };
        }
        if (Object.values(itemModify[itemName]).length > 0) {
          parames = {
            table: tableName,
            objid: objId,
            data: { ...itemModify },
            after: { ...itemModifyLabel },
            before: itemBeforeLabel

          };
        }
        if (Object.values(itemAdd[itemName]).length > 0 && Object.values(itemModify[itemName]).length > 0 && Object.values(modify[tableName]).length > 0) {
          const value = Object.assign({}, modify, labelregroupTableName);
          parames = {
            table: tableName,
            objid: objId,
            data: {
              ...modify,
              ...itemModify,
              ...itemTableAdd
            },
            after: { 
              ...modifyLabel,
              ...itemModifyLabel 
              
            },
            before: {
              ...value,
              ...itemBeforeLabel
            } 
          };
        }
      } else { // ‰∏ªË°®‰øÆÊîπ
        const value = Object.assign({}, modify, labelregroupTableName);
        parames = {
          table: tableName,
          objid: objId,
          data: { ...modify },
          after: { ...modifyLabel },
          before: value,
        };
      }
      network.post('/p/cs/objectSave', urlSearchParams(parames)).then((res) => {
        if (res.data.code === 0) {
          const data = res.data;
          resolve();
          commit('updateNewMainTableAddSaveData', { data, itemName });
        } else {
          reject();
        }
      });
    }
  },
  
  getObjectTrySubmit({
    commit
  }, {
    objId,
    table,
    path,
    resolve,
    reject
  }) { // Ëé∑ÂèñÊèê‰∫§Êï∞ÊçÆ
    objId = objId === 'New' ? '-1' : objId;
    network.post(path || '/p/cs/objectSubmit', urlSearchParams({
      table,
      objid: objId
    })).then((res) => {
      if (res.data.code === 0) {
        const submitData = res.data;
        resolve();
        commit('updateSubmitData', submitData);
      } else {
        const data = res.data.data;
        commit('updatetooltipForItemTableData', data);
        reject();
      }
    });
  },
  getObjectTryUnSubmit({
    commit
  }, {
    objId,
    table,
    path,
    resolve,
    reject
  }) { // Ëé∑ÂèñÂèñÊ∂àÊèê‰∫§Êï∞ÊçÆ
    objId = objId === 'New' ? '-1' : objId;
    network.post(path || '/p/cs/objectUnSubmit', urlSearchParams({
      table,
      objid: objId
    })).then((res) => {
      if (res.data.code === 0) {
        const unSubmitData = res.data;
        resolve();
        commit('updateUnSubmitData', unSubmitData);
      } else {
        const data = res.data.data;
        commit('updatetooltipForItemTableData', data);
        reject();
      }
    });
  },
  getObjectTryInvalid({
    commit
  }, {
    objId,
    table,
    path,
    resolve,
    reject
  }) { // Ëé∑Âèñ‰ΩúÂ∫üÊï∞ÊçÆ
    objId = objId === 'New' ? '-1' : objId;
    network.post(path || '/p/cs/objectVoid', urlSearchParams({
      table,
      objid: objId
    })).then((res) => {
      if (res.data.code === 0) {
        const invalidData = res.data;
        resolve();

        commit('updateiInvalidData', invalidData);
      } else {
        const data = res.data.data;
        commit('updatetooltipForItemTableData', data);
        reject();
      }
    });
  },
  getExportQueryForButtons({
    commit
  }, // ÂØºÂá∫
  {
    OBJ,
    resolve,
    reject
  }) {
    network.post('/p/cs/export', urlSearchParams(
      OBJ
    )).then((res) => {
      if (res.data.code === 0) {
        resolve();
        const data = res.data.data;
        commit('updateButtonsExport', data);
      } else {
        reject();
      }
    });
  },
  getObjTabActionSlientConfirm({
    commit
  }, {
    tab,
    params,
    path,
    resolve, reject
  }) {
    let actionName = '';
    if (path.search('/') === -1) {
      actionName = '';
      network.post(actionName || '/p/cs/exeAction', urlSearchParams({
        actionid: tab.webid,
        webaction: null,
        param: JSON.stringify(params),
      })).then((res) => {
        if (res.data.code === 0) {
          const invalidData = res.data;
          resolve();
  
          commit('updateObjTabActionSlientConfirm', invalidData);
        } else {
          reject();
        }
      }).catch(() => {
        reject();
      });
    } else {
      actionName = path;

      network.post(actionName || '/p/cs/exeAction', params).then((res) => {
        if (res.data.code === 0) {
          const invalidData = res.data;
          resolve();
  
          commit('updateObjTabActionSlientConfirm', invalidData);
        } else {
          reject();
        }
      }).catch(() => {
        reject();
      });
    }
  },
};
